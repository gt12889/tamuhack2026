{
  "name": "ElevenLabs Voice Integration",
  "description": "Complete the ElevenLabs text-to-speech integration to provide natural, high-quality voice responses in the AA Voice Concierge application.",
  "stories": [
    {
      "id": "US-001",
      "title": "Configure ElevenLabs API key in backend",
      "description": "As a developer, I need to add the ElevenLabs API key to the environment so the service can authenticate with the API.",
      "acceptance_criteria": [
        "Add ELEVENLABS_API_KEY to backend/.env file with value: sk_3b814dcfe55f6bf0cad92f17460c95e6e3793d4fd49b356f",
        "Verify settings.py correctly reads ELEVENLABS_API_KEY from environment",
        "Backend server starts without ElevenLabs-related errors",
        "Typecheck/lint passes"
      ],
      "files": [
        "backend/.env",
        "backend/voice_concierge/settings.py"
      ]
    },
    {
      "id": "US-002",
      "title": "Test ElevenLabs synthesis endpoint",
      "description": "As a developer, I need to verify the /api/synthesize/ endpoint returns valid audio data.",
      "acceptance_criteria": [
        "POST to /api/synthesize/ with {\"text\": \"Hello, testing\"} returns audio_url",
        "audio_url contains valid base64-encoded MP3 data (data:audio/mpeg;base64,...)",
        "Response includes duration_ms estimate",
        "Error responses return fallback with text for browser TTS"
      ],
      "files": [
        "backend/api/views.py",
        "backend/api/services/elevenlabs_service.py"
      ]
    },
    {
      "id": "US-003",
      "title": "Verify conversation flow returns audio",
      "description": "As a user, I want to hear the assistant's responses spoken aloud when I start a conversation.",
      "acceptance_criteria": [
        "POST to /api/conversation/start/ returns audio_url in response",
        "POST to /api/conversation/message/ returns audio_url with reply",
        "Audio URLs are playable in browser",
        "Verify in browser: greeting plays when clicking Start button"
      ],
      "files": [
        "backend/api/views.py",
        "frontend/src/app/page.tsx"
      ]
    },
    {
      "id": "US-004",
      "title": "Implement browser TTS fallback in frontend",
      "description": "As a user, I want to hear responses even when ElevenLabs is unavailable, using my browser's built-in speech.",
      "acceptance_criteria": [
        "When audio_url is null and fallback=true, use Web Speech API",
        "Create useBrowserTTS hook with speak(text) function",
        "Fallback triggers automatically when ElevenLabs response has fallback: true",
        "Fallback voice speaks at appropriate speed for elderly users",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "files": [
        "frontend/src/hooks/useBrowserTTS.ts",
        "frontend/src/hooks/index.ts",
        "frontend/src/app/page.tsx"
      ]
    },
    {
      "id": "US-005",
      "title": "Add audio loading state to UI",
      "description": "As a user, I want visual feedback while audio is loading so I know to wait.",
      "acceptance_criteria": [
        "VoiceButton shows loading animation while audio is being fetched",
        "MessageDisplay shows speaker icon when assistant message has audio",
        "User cannot interrupt while audio is playing (button shows speaking state)",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "files": [
        "frontend/src/components/VoiceButton.tsx",
        "frontend/src/components/MessageDisplay.tsx"
      ]
    },
    {
      "id": "US-006",
      "title": "Cache frequently used phrases",
      "description": "As a developer, I want common phrases pre-cached to reduce API latency and costs.",
      "acceptance_criteria": [
        "Greeting phrase audio is cached on first synthesis",
        "CACHED_PHRASES dict in elevenlabs_service.py lists common phrases",
        "Cache TTL is 15 minutes (existing implementation)",
        "Cached responses return instantly without API call"
      ],
      "files": [
        "backend/api/services/elevenlabs_service.py"
      ]
    }
  ],
  "technical_notes": {
    "api_key": "sk_3b814dcfe55f6bf0cad92f17460c95e6e3793d4fd49b356f",
    "model": "eleven_monolingual_v1",
    "voice_id_en": "EXAVITQu4vr4xnSDxMaL",
    "voice_id_es": "ErXwobaYiN019PkySvjV",
    "audio_format": "audio/mpeg",
    "timeout_seconds": 30,
    "cache_ttl_minutes": 15
  }
}
